<subsystem_definition>

    <ports>
        <in alias="b_st"    type="velma_core_cs_ve_body_msgs::Status"     side="bottom"   ipc="true" >
            <trigger min="0.0008" avg="0.001" max="0.0012" sim_max="1.0" />
        </in>
        <out alias="b_cmd"  type="velma_core_cs_ve_body_msgs::Command"    side="bottom"   ipc="true"/>

        <in alias="cmd"     type="velma_core_cs_task_cs_msgs::Command"    side="top"      ipc="true" />
        <out alias="st"     type="velma_core_cs_task_cs_msgs::Status"     side="top"      ipc="true"/>
    </ports>

    <errors>
        <err name="COMPONENT" />
        <err name="VE_BODY_SAFE" />
        <err name="VE_BODY_ST_INV" />
    </errors>

    <predicates>
        <predicate name="graphSafe" />
        <predicate name="graphCartImp" />
        <predicate name="graphJntImp" />
        <predicate name="veBodyInSafeState" />
        <predicate name="veBodyStatusValid" />
        <predicate name="recvCartImpCmd" />
        <predicate name="recvJntImpCmd" />
        <predicate name="recvOneCmd" />
    </predicates>

    <output_scopes>
        <scope name="upper_body" />
        <scope name="right_hand" />
        <scope name="left_hand" />
        <scope name="neck" />
    </output_scopes>

    <behaviors>

        <behavior name="test_all_scopes"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="upper_body" />
            <scope name="right_hand" />
            <scope name="left_hand" />
            <scope name="neck" />
        </behavior>

        <behavior name="test_all_scopes_2"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="upper_body" />
            <scope name="right_hand" />
            <scope name="left_hand" />
            <scope name="neck" />
        </behavior>

        <behavior name="test_lh_scope"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="left_hand" />
        </behavior>

        <behavior name="test_lh_scope_2"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="left_hand" />
        </behavior>

        <behavior name="test_rh_scope"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="right_hand" />
        </behavior>

        <behavior name="test_lh_neck_scope"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="left_hand" />
            <scope name="neck" />
        </behavior>

        <behavior name="test_neck_scope"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="neck" />
        </behavior>

        <behavior name="test_neck_scope_2"
            init_cond="FALSE"
            stop_cond="FALSE"
            err_cond="FALSE" >
            <scope name="neck" />
        </behavior>

        <behavior name="idle_hands_neck" is_initial="true"
            init_cond="(not veBodyStatusValid) or veBodyInSafeState"
            stop_cond="veBodyStatusValid and (not veBodyInSafeState)"
            err_cond="FALSE" >
<!--            <running_component name="idle" />-->
            <scope name="right_hand" />
            <scope name="left_hand" />
            <scope name="neck" />
        </behavior>

        <behavior name="position_hands_neck"
            init_cond="(not veBodyInSafeState) and veBodyStatusValid"
            stop_cond="veBodyStatusValid and (not veBodyInSafeState)"
            err_cond="FALSE" >
<!--            <running_component name="HeadTrajectoryGeneratorJoint" />-->
            <scope name="right_hand" />
            <scope name="left_hand" />
            <scope name="neck" />
        </behavior>
        
        <behavior name="idle" is_initial="true"
            init_cond="(not veBodyStatusValid) or veBodyInSafeState"
            stop_cond="veBodyStatusValid and (not veBodyInSafeState)"
            err_cond="FALSE" >
            <running_component name="idle" />
            <scope name="upper_body" />
        </behavior>

        <behavior name="safe"
            init_cond="(not veBodyInSafeState) and veBodyStatusValid and (IN_ERROR or (not recvOneCmd))"
            stop_cond="recvOneCmd"
            err_cond="(not veBodyStatusValid) or veBodyInSafeState" >
            <running_component name="safe" />
            <running_component name="Mass" />
            <running_component name="FK" />
            <running_component name="JntImp" />
            <scope name="upper_body" />
        </behavior>

        <behavior name="cart_imp"
            init_cond="(not IN_ERROR) and recvOneCmd and recvCartImpCmd and veBodyStatusValid and (not veBodyInSafeState)"
            stop_cond="veBodyStatusValid and recvOneCmd and (not recvCartImpCmd)"
            err_cond="(not graphCartImp) or (not veBodyStatusValid) or (veBodyInSafeState)" >
            <running_component name="CImp" />
            <running_component name="Mass" />
            <running_component name="JntLimit" />
            <running_component name="PoseIntLeft" />
            <running_component name="PoseIntRight" />
            <running_component name="FK" />
            <scope name="upper_body" />
        </behavior>

        <behavior name="jnt_imp"
            init_cond="(not IN_ERROR) and recvOneCmd and recvJntImpCmd and veBodyStatusValid and (not veBodyInSafeState)"
            stop_cond="veBodyStatusValid and recvOneCmd and (not recvJntImpCmd)"
            err_cond="(not graphJntImp) or (not veBodyStatusValid) or (veBodyInSafeState)" >
            <running_component name="Mass" />
            <running_component name="TrajectoryGeneratorJoint" />
            <running_component name="FK" />
            <running_component name="JntImp" />
            <scope name="upper_body" />
        </behavior>

    </behaviors>

    <simulation use_ros_sim_clock="true" use_sim_clock="true" />

</subsystem_definition>
