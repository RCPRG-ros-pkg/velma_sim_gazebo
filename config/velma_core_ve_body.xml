<subsystem_configuration>
    <import package="controller_common" />
    <import package="rtt_geometry_msgs" />
    <import package="rtt_velma_core_cs_ve_body_msgs" />
    <import package="rtt_velma_core_cs_ve_body_subsystem_ports" />
    <import package="velma_core_ve_body" />
    <import package="eigen_typekit" />
    <import package="rtt_std_msgs" />
    <import package="port_operations" />
    <import package="rtt_control_msgs" />
    <import package="lwr_fri" />
    <import package="velma_controller" />
    <import package="rtt_cartesian_trajectory_msgs" />
    <import package="rtt_std_msgs" />
    <import package="rtt_tf" />
    <import package="velma_sim" />

    <component name="TorsoSim" type="TorsoSim" running="true" />
    <component name="LWRrSim" type="LWRSim" running="true" />
    <component name="LWRlSim" type="LWRSim" running="true" />
    <component name="LeftFtSensor" type="FtSensorSim" running="true" />
    <component name="RightFtSensor" type="FtSensorSim" running="true" />
    <component name="LeftHand" type="BarrettHandSim" running="true" />
    <component name="RightHand" type="BarrettHandSim" running="true" />
    <component name="LeftHandOptoforce" type="OptoforceSim" running="true" />
    <component name="RightHandTactile" type="BarrettTactileSim" running="true" />

    <component name="TorsoPanTransmision"       type="SimpleTransmision" running="true" />
    <component name="TorsoPanTransmisionInv"    type="SimpleTransmisionInv" />
    <component name="HeadPanTransmision"        type="SimpleTransmision" running="true" />
    <component name="HeadPanTransmisionInv"     type="SimpleTransmisionInv" />
    <component name="HeadTiltTransmision"       type="SimpleTransmision" running="true" />
    <component name="HeadTiltTransmisionInv"    type="SimpleTransmisionInv" />

    <component name="bypass" type="velma_core_ve_body_types::BypassComponent" />
    <component name="safe" type="velma_core_ve_body_types::SafeComponent" />
    <component name="packet_counter" type="velma_core_ve_body_types::PacketCounterComponent" running="true" />
    <component name="hw_state" type="velma_core_ve_body_types::HwState" running="true" />

    <io_buffer alias="hi_st" name="velma_core_cs_ve_body_msgs_Status" />
    <io_buffer alias="hi_cmd" name="velma_core_cs_ve_body_msgs_Command" />

    <ros_stream port="master_component.hi_cmd_OUTPORT"      topic="/velma_core_ve_body/hi_cmd" />

    <ros_stream port="hi_stConcate.msg_OUTPORT"             topic="/velma_core_ve_body/hi_st" />

    <connection from="hi_cmdSplit.hpMotor_q_OUTPORT" to="HeadPanTransmisionInv.JointPosition_INPORT" />

    <connection from="hi_cmdSplit.htMotor_q_OUTPORT" to="HeadTiltTransmisionInv.JointPosition_INPORT" />

    <connection from="TorsoSim.head_pan_motor_position_OUTPORT"         to="HeadPanTransmision.MotorPosition_INPORT" />
    <connection from="TorsoSim.head_pan_motor_velocity_OUTPORT"         to="HeadPanTransmision.MotorVelocity_INPORT" />
    <connection from="HeadPanTransmision.JointPosition_OUTPORT"         to="hi_stConcate.hpMotor_q_INPORT" />
    <connection from="HeadPanTransmision.JointVelocity_OUTPORT"         to="hi_stConcate.hpMotor_dq_INPORT" />

    <connection from="TorsoSim.head_tilt_motor_position_OUTPORT"        to="HeadTiltTransmision.MotorPosition_INPORT" />
    <connection from="TorsoSim.head_tilt_motor_velocity_OUTPORT"        to="HeadTiltTransmision.MotorVelocity_INPORT" />
    <connection from="HeadTiltTransmision.JointPosition_OUTPORT" to="hi_stConcate.htMotor_q_INPORT" />
    <connection from="HeadTiltTransmision.JointVelocity_OUTPORT" to="hi_stConcate.htMotor_dq_INPORT" />

    <connection from="TorsoSim.t_MotorPosition_OUTPORT" to="TorsoPanTransmision.MotorPosition_INPORT" />
    <connection from="TorsoSim.t_MotorVelocity_OUTPORT" to="TorsoPanTransmision.MotorVelocity_INPORT" />

    <connection from="safe.sc_OUTPORT"              to="hi_stConcate.sc_INPORT" />
    <connection from="safe.rArm_t_OUTPORT"          to="LWRrSim.JointTorqueCommand_INPORT" />
    <connection from="safe.rArmFri_OUTPORT"         to="LWRrSim.KRL_CMD_INPORT" />
    <connection from="safe.lArm_t_OUTPORT"          to="LWRlSim.JointTorqueCommand_INPORT" />
    <connection from="safe.lArmFri_OUTPORT"         to="LWRlSim.KRL_CMD_INPORT" />
    <connection from="safe.tMotor_i_OUTPORT"        to="TorsoSim.t_MotorCurrentCommand_INPORT" />
    <connection from="safe.hpMotor_q_OUTPORT"       to="TorsoSim.head_pan_motor_position_command_INPORT" />
    <connection from="safe.htMotor_q_OUTPORT"       to="TorsoSim.head_tilt_motor_position_command_INPORT" />
    <connection from="LWRrSim.JointVelocity_OUTPORT"                    to="safe.rArm_dq_INPORT" name="dq" />
    <connection from="LWRrSim.FRIState_OUTPORT"                         to="safe.rArmFriIntf_INPORT" />
    <connection from="LWRrSim.RobotState_OUTPORT"                       to="safe.rArmFriRobot_INPORT" />
    <connection from="LWRlSim.JointVelocity_OUTPORT"                    to="safe.lArm_dq_INPORT" name="dq" />
    <connection from="LWRlSim.FRIState_OUTPORT"                         to="safe.lArmFriIntf_INPORT" />
    <connection from="LWRlSim.RobotState_OUTPORT"                       to="safe.lArmFriRobot_INPORT" />
    <connection from="TorsoSim.t_MotorVelocity_OUTPORT"                 to="safe.tMotor_dq_INPORT" name="dq_t" />
    <connection from="TorsoSim.head_pan_motor_position_OUTPORT"         to="safe.hpMotor_q_INPORT" name="q_hp" />
    <connection from="TorsoSim.head_tilt_motor_position_OUTPORT"        to="safe.htMotor_q_INPORT" name="q_ht" />

    <connection from="bypass.rArm_t_OUTPORT"        to="LWRrSim.JointTorqueCommand_INPORT" />
    <connection from="bypass.lArm_t_OUTPORT"        to="LWRlSim.JointTorqueCommand_INPORT" />
    <connection from="bypass.tMotor_i_OUTPORT"      to="TorsoSim.t_MotorCurrentCommand_INPORT" />
    <connection from="bypass.hpMotor_q_OUTPORT"     to="TorsoSim.head_pan_motor_position_command_INPORT" />
    <connection from="bypass.htMotor_q_OUTPORT"     to="TorsoSim.head_tilt_motor_position_command_INPORT" />
    <connection from="bypass.rHand_q_OUTPORT"       to="RightHand.q_INPORT" />
    <connection from="bypass.rHand_dq_OUTPORT"      to="RightHand.v_INPORT" />
    <connection from="bypass.rHand_max_i_OUTPORT"   to="RightHand.t_INPORT" />
    <connection from="bypass.rHand_max_p_OUTPORT"   to="RightHand.mp_INPORT" />
    <connection from="bypass.rHand_hold_OUTPORT"    to="RightHand.hold_INPORT" />
    <connection from="bypass.lHand_q_OUTPORT"       to="LeftHand.q_INPORT" />
    <connection from="bypass.lHand_dq_OUTPORT"      to="LeftHand.v_INPORT" />
    <connection from="bypass.lHand_max_i_OUTPORT"   to="LeftHand.t_INPORT" />
    <connection from="bypass.lHand_max_p_OUTPORT"   to="LeftHand.mp_INPORT" />
    <connection from="bypass.lHand_hold_OUTPORT"    to="LeftHand.hold_INPORT" />
    <connection from="bypass.sc_OUTPORT"            to="hi_stConcate.sc_INPORT" />
    <connection from="TorsoPanTransmisionInv.MotorCurrent_OUTPORT"  to="bypass.tMotor_i_INPORT" />
    <connection from="hi_cmdSplit.lArm_t_OUTPORT"                   to="bypass.lArm_t_INPORT" />
    <connection from="hi_cmdSplit.rArm_t_OUTPORT"                   to="bypass.rArm_t_INPORT" />
    <connection from="hi_cmdSplit.rHand_q_OUTPORT"                  to="bypass.rHand_q_INPORT" />
    <connection from="hi_cmdSplit.rHand_dq_OUTPORT"                 to="bypass.rHand_dq_INPORT" />
    <connection from="hi_cmdSplit.rHand_max_i_OUTPORT"              to="bypass.rHand_max_i_INPORT" />
    <connection from="hi_cmdSplit.rHand_max_p_OUTPORT"              to="bypass.rHand_max_p_INPORT" />
    <connection from="hi_cmdSplit.rHand_hold_OUTPORT"               to="bypass.rHand_hold_INPORT" />
    <connection from="hi_cmdSplit.lHand_q_OUTPORT"                  to="bypass.lHand_q_INPORT" />
    <connection from="hi_cmdSplit.lHand_dq_OUTPORT"                 to="bypass.lHand_dq_INPORT" />
    <connection from="hi_cmdSplit.lHand_max_i_OUTPORT"              to="bypass.lHand_max_i_INPORT" />
    <connection from="hi_cmdSplit.lHand_max_p_OUTPORT"              to="bypass.lHand_max_p_INPORT" />
    <connection from="hi_cmdSplit.lHand_hold_OUTPORT"               to="bypass.lHand_hold_INPORT" />
    <connection from="HeadPanTransmisionInv.MotorPosition_OUTPORT"  to="bypass.hpMotor_q_INPORT" />
    <connection from="HeadTiltTransmisionInv.MotorPosition_OUTPORT" to="bypass.htMotor_q_INPORT" />


    <connection from="hi_cmdSplit.tMotor_i_OUTPORT" to="TorsoPanTransmisionInv.JointTorque_INPORT" />

    <connection from="packet_counter.packet_counter_OUTPORT"            to="hi_stConcate.test_INPORT" />

    <connection from="LWRrSim.JointPosition_OUTPORT"                    to="hi_stConcate.rArm_q_INPORT" name="q" />
    <connection from="LWRrSim.JointVelocity_OUTPORT"                    to="hi_stConcate.rArm_dq_INPORT" name="dq" />
    <connection from="LWRrSim.JointTorque_OUTPORT"                      to="hi_stConcate.rArm_t_INPORT" name="t" />
    <connection from="LWRrSim.GravityTorque_OUTPORT"                    to="hi_stConcate.rArm_gt_INPORT" name="gt" />
    <connection from="LWRrSim.CartesianWrench_OUTPORT"                  to="hi_stConcate.rArm_w_INPORT" name="wr" />
    <connection from="LWRrSim.MassMatrix_OUTPORT"                       to="hi_stConcate.rArm_mmx_INPORT" name="M" />

    <connection from="LWRlSim.JointPosition_OUTPORT"                    to="hi_stConcate.lArm_q_INPORT" name="q" />
    <connection from="LWRlSim.JointVelocity_OUTPORT"                    to="hi_stConcate.lArm_dq_INPORT" name="dq" />
    <connection from="LWRlSim.JointTorque_OUTPORT"                      to="hi_stConcate.lArm_t_INPORT" name="t" />
    <connection from="LWRlSim.GravityTorque_OUTPORT"                    to="hi_stConcate.lArm_gt_INPORT" name="gt" />
    <connection from="LWRlSim.CartesianWrench_OUTPORT"                  to="hi_stConcate.lArm_w_INPORT" name="wr" />
    <connection from="LWRlSim.MassMatrix_OUTPORT"                       to="hi_stConcate.lArm_mmx_INPORT" name="M" />

    <connection from="TorsoPanTransmision.JointPosition_OUTPORT"        to="hi_stConcate.tMotor_q_INPORT" name="q" />
    <connection from="TorsoPanTransmision.JointVelocity_OUTPORT"        to="hi_stConcate.tMotor_dq_INPORT" name="dq" />

    <connection from="RightFtSensor.rawWrench_OUTPORT"                  to="hi_stConcate.rFt_rw_INPORT" name="raw_wr" />
    <connection from="RightFtSensor.fastFilteredWrench_OUTPORT"         to="hi_stConcate.rFt_ffw_INPORT" name="fast_wr" />
    <connection from="RightFtSensor.slowFilteredWrench_OUTPORT"         to="hi_stConcate.rFt_sfw_INPORT" name="slow_wr" />
    <connection from="LeftFtSensor.rawWrench_OUTPORT"                   to="hi_stConcate.lFt_rw_INPORT" name="raw_wr" />
    <connection from="LeftFtSensor.fastFilteredWrench_OUTPORT"          to="hi_stConcate.lFt_ffw_INPORT" name="fast_wr" />
    <connection from="LeftFtSensor.slowFilteredWrench_OUTPORT"          to="hi_stConcate.lFt_sfw_INPORT" name="slow_wr" />

    <connection from="LWRrSim.FRIState_OUTPORT"                         to="hw_state.rArm_fri_state_INPORT" />
    <connection from="LWRrSim.RobotState_OUTPORT"                       to="hw_state.rArm_robot_state_INPORT" />
    <connection from="LWRlSim.FRIState_OUTPORT"                         to="hw_state.lArm_fri_state_INPORT" />
    <connection from="LWRlSim.RobotState_OUTPORT"                       to="hw_state.lArm_robot_state_INPORT" />

    <connection from="RightHand.q_OUTPORT"              to="hi_stConcate.rHand_q_INPORT" />
    <connection from="RightHand.status_OUTPORT"         to="hi_stConcate.rHand_s_INPORT" />

    <connection from="LeftHand.q_OUTPORT"               to="hi_stConcate.lHand_q_INPORT" />
    <connection from="LeftHand.status_OUTPORT"          to="hi_stConcate.lHand_s_INPORT" />

    <latched_connections>
        <components from="LWRrSim" to="safe" />
        <components from="LWRlSim" to="safe" />
        <components from="TorsoSim" to="safe" />
    </latched_connections>

</subsystem_configuration>
